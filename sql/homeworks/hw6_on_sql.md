# Домашка #6 по оконным функциям в SQL  
В локальном репозитории **da_course** создайте ветку ***hw31***. Переключитесь на новую ветку. В DBeaver выберите команду `Open SQL console` и сохраните файл в репозитории под именем `hw6_on_sql.sql`.  

## Задача №1   
1. Для каждого клиента посчитайте сумму продаж по годам и месяцам. Итоговая таблица должна содержать следующие поля: *customer_id*, *full_name*, *monthkey (в числовом формате)*, *total*.
2. Дополните получившуюся таблицу, посчитав для каждого клиента какой процент от общих продаж за каждый месяц он принёс. Т.е. если например в феврале 2023-го общая сумма продаж всем клиентам составила 100, а сумма продаж клиенту Х составила 15, тогда процент расчитывается как 15/100.   
3. Дополните таблицу, посчитав для каждого клиента нарастающий итог за каждый год.  
4. Дополните таблицу, добавив для каждого клиента скользящее среднее за 3 последних периода (2 предыдущих периода и текущий период).  
5. Дополните таблицу, посчитав для каждого клиента разницу между суммой текущего периода и суммой предыдущего периода.  

## Задача №2   
1. Верните **топ 3** продаваемых альбома **за каждый год**. Итоговая таблица должна содержать следующие поля: *год*, *название альбома*, *имя исполнителя*, *количество проданных треков*.  

## Задача №3  
1. Посчитайте количество клиентов, закреплённых за каждым сотрудником. Итоговая таблица должна содержать следующие поля: id сотрудника, полное имя, количество клиентов
2. К предыдущему запросу добавьте поле, показывающее какой процент от общей клиентской базы обслуживает каждый сотрудник.

## Задача №4  
1. Для каждого клиента определите дату первой и последней покупки. Посчитайте разницу в годах между первой и последней покупкой.

---
Сделайте коммит, пуш и создайте pull request.  
В классруме прикрепите скриншот вкладки `files changed` вашего pull request-а и **ссылку** на репозиторий.
